<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Retail Hub — El centro de soluciones para tu negocio</title>
<meta name="description" content="Consultoría retail: operación, capacitación, diseño y marketing para ordenar, optimizar y escalar tu tienda." />
<meta name="theme-color" content="#1570EF" />
<link rel="icon" href="assets/favicon.png" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
  :root{
    --brand-blue:#1570EF; --brand-green:#16A34A; --brand-white:#FFFFFF;
    --ink:#0F172A; --muted:#475569; --bg:#0B1220; --card:#0F1626;
    --line:rgba(255,255,255,.08); --shadow:0 10px 30px rgba(0,0,0,.35);
    --radius:18px; --maxw:1100px; --header-h:72px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:
    radial-gradient(1200px 800px at 80% -10%, rgba(21,112,239,.25), transparent 60%),
    radial-gradient(1000px 600px at -10% 10%, rgba(22,163,74,.18), transparent 60%), var(--bg);
    color:#E5E7EB; line-height:1.6}
  a{color:var(--brand-blue)} a:hover{text-decoration:underline}
  img{max-width:100%; height:auto; display:block; image-rendering:auto}
.hero .card img{width:100%; max-width:100%; height:auto; object-fit:contain}
  .container{max-width:var(--maxw); margin:0 auto; padding:0 20px}

  header{position:sticky; top:0; z-index:40; background:rgba(11,18,32,.65); backdrop-filter: blur(8px) saturate(160%); border-bottom:1px solid var(--line)}
  .nav{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
  .brand{display:flex; align-items:center; gap:12px; font-weight:800; cursor:pointer}
  .brand img{height:72px; width:auto; border-radius:8px; object-fit:contain}
  .nav a{border:1px solid var(--line); padding:8px 12px; border-radius:10px; color:#E5E7EB; text-decoration:none}

  main section{padding:54px 0}
  .hero{display:grid; grid-template-columns:1.2fr 1fr; gap:28px; padding:60px 0 36px}
  .badge{display:inline-flex; align-items:center; gap:8px; font-size:12px; color:#CBD5E1; border:1px solid var(--line); padding:6px 10px; border-radius:999px}
  h1{font-size:clamp(28px,5vw,54px); line-height:1.1; margin:14px 0}
  .lead{font-size:clamp(15px,1.6vw,18px); color:#CBD5E1}
  .cta{display:flex; gap:12px; margin-top:18px; flex-wrap:wrap}
  .btn{display:inline-block; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer}
  .btn-primary{background:linear-gradient(135deg,var(--brand-blue),#6366F1); color:#0B1220; box-shadow:var(--shadow)}
  .btn-ghost{background:transparent; border:1px solid var(--line); color:#E5E7EB}

  .card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
        border:1px solid var(--line); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow);
        transition: box-shadow .25s ease, border-color .25s ease, transform .2s ease;}
  .card.glow:hover,.card.glow:focus-within{border-color: var(--accent); box-shadow:0 0 0 2px var(--accent), 0 0 20px 4px var(--accentA); transform: translateY(-2px);}

  /* ===== Plan Modal Themes ===== */
  #planModal .modal { width:min(420px,92vw); max-height:90vh; overflow-y:auto; background:var(--card);
    border:2px solid var(--accent); border-radius:20px; box-shadow:0 0 0 2px var(--accent), 0 0 20px 4px var(--accentA), var(--shadow); padding:22px; }
  #planContent{ background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border-radius: calc(var(--radius) - 4px); padding:18px; }
  #planModal.plan--Basico { --accent: var(--brand-white); --accentA: rgba(255,255,255,.35); }
  #planModal.plan--Pro    { --accent: var(--brand-blue);  --accentA: rgba(21,112,239,.35); }
  #planModal.plan--Max    { --accent: var(--brand-green); --accentA: rgba(22,163,74,.35); }
  #planCtaBtn { margin-top:14px; }

  .grid3{display:grid; grid-template-columns:repeat(3,1fr); gap:18px}
  .pill{display:inline-flex; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--line); color:#A3AED0}
  .pricing .price{font-size:28px; font-weight:800}
  .pricing .tag{font-size:12px; color:#A3AED0}
  ul.list-simple{list-style: disc; margin:0; padding-left:20px}
  ul.list-simple li{margin-bottom:6px}
  footer{padding:28px 0 60px; color:#A3AED0; border-top:1px solid var(--line)}
  .reveal{opacity:0; transform:translateY(18px); transition:opacity .7s ease, transform .7s ease}
  .reveal.visible{opacity:1; transform:translateY(0)}
  section[id]{scroll-margin-top: calc(var(--header-h) + 8px)}
  html{scroll-behavior: smooth;}
  @media (max-width:980px){ .hero{grid-template-columns:1fr} .grid3{grid-template-columns:1fr} }

  /* ===== Modal ===== */
  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); backdrop-filter: blur(4px);
    display:none; align-items:center; justify-content:center; z-index:60; }
  .modal-backdrop.active{display:flex}
  .modal{ width:min(760px, 92vw); max-height:86vh; overflow:auto; background:var(--card); border:1px solid var(--line);
    border-radius:20px; box-shadow:var(--shadow); padding:22px; }
  .modal header{position:sticky; top:0; background:transparent; border:none; padding:0 0 12px 0}
  .modal h3{margin:0}
  .modal .close{ margin-left:auto; background:transparent; border:1px solid var(--line); color:#E5E7EB;
    border-radius:10px; padding:6px 10px; cursor:pointer; }

  /* Campos form modal */
  form{display:grid; gap:14px}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  label{display:block; font-size:14px; color:#CBD5E1; margin-bottom:4px}
  input, select, textarea{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line);
    background:#0c1424; color:#E5E7EB; outline:none;
  }
  textarea{min-height:110px; resize:vertical}
  .helper{font-size:12px; color:#A3AED0}
  .btn-submit{background:linear-gradient(135deg,var(--brand-green),#22d3ee); color:#0B1220; font-weight:800}

  /* ===== Flatpickr dentro del modal de Agenda ===== */
  #agendaModal .flatpickr-calendar{ z-index:80 !important; }

  /* ===== Input group (fecha + hora juntas) ===== */
  .input-group{ display:flex; align-items:stretch; width:100%; max-width:520px; }
  .input-group .input-lite.left{
    border-top-right-radius:0; border-bottom-right-radius:0; border-right:0;
  }
  .input-group .select-lite.right{
    border-top-left-radius:0; border-bottom-left-radius:0;
  }
  .input-lite, .select-lite{
    background:#0F1626; color:#E5E7EB;
    border:1px solid var(--line); height:42px;
    padding:10px 12px; border-radius:10px;
  }
  .input-lite:focus, .select-lite:focus{
    outline:none; border-color:#1570EF; box-shadow:0 0 0 2px rgba(21,112,239,.35);
  }
  .select-lite{ appearance:none; }

  /* Icono calendario (oscuro) en el input de fecha */
  #agendaDate.input-lite{
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23E5E7EB' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'/%3E%3Cline x1='16' y1='2' x2='16' y2='6'/%3E%3Cline x1='8' y1='2' x2='8' y2='6'/%3E%3Cline x1='3' y1='10' x2='21' y2='10'/%3E%3C/svg%3E");
    background-repeat:no-repeat; background-position:right 10px center; padding-right:36px;
  }

  /* Calendario estilo Outlook Dark */
  #agendaModal .flatpickr-calendar{
    background:#1E293B; border:1px solid #334155; border-radius:12px;
    box-shadow:0 10px 28px rgba(0,0,0,.55); color:#F1F5F9;
  }
  #agendaModal .flatpickr-months{ background:#1E293B; border-bottom:1px solid #334155; }
  #agendaModal .flatpickr-current-month .cur-month,
  #agendaModal .flatpickr-current-month .numInputWrapper input{ font-weight:700; color:#F1F5F9; }
  #agendaModal .flatpickr-weekdays, #agendaModal .flatpickr-days{ background:#1E293B; color:#E2E8F0; }
  #agendaModal .flatpickr-day{ border-radius:8px; }
  #agendaModal .flatpickr-day:hover{ background:#334155; color:#fff; }
  #agendaModal .flatpickr-day.selected{ background:#1570EF; border-color:#1570EF; color:#fff !important; }
#agendaModal .flatpickr-day:not(.flatpickr-disabled):not(.prevMonthDay):not(.nextMonthDay){ color:#F8FAFC !important; opacity:1 !important; font-weight:700; }
#agendaModal .flatpickr-day.today:not(.selected){ border:1px solid #94a3b8 !important; color:#fff !important; }
  #agendaModal .flatpickr-day.flatpickr-disabled,
  #agendaModal .flatpickr-day.prevMonthDay, #agendaModal .flatpickr-day.nextMonthDay{ color:#64748B; }

  /* Dropdown de horas oscuro */
  #agendaTime.select-lite option{ background:#0F1626; color:#E5E7EB; }

  /* Responsive: apilar si es estrecho */
  @media (max-width:560px){
    .input-group{ flex-direction:column; gap:8px; max-width:100%; }
    .input-group .input-lite.left{ border-right:1px solid var(--line); border-radius:10px; }
    .input-group .select-lite.right{ border-radius:10px; }
  }

  /* sr-only helper (para accesibilidad) */
  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

  @media (max-width: 760px){
    .grid3{ grid-template-columns:1fr; }
    .cta .btn{ width:100%; text-align:center; }
    header nav{ overflow-x:auto; white-space:nowrap; -webkit-overflow-scrolling:touch; scrollbar-width:none; }
    header nav::-webkit-scrollbar{ display:none; }
    .brand img{ height:48px; }
  }

</style>

<!-- Flatpickr JS + locale ES -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand" id="brandHome">
        <img src="assets/Logo-blanco-sf.png" alt="Retail Hub" onerror="this.replaceWith(document.getElementById('logoInline').content.cloneNode(true))">
      </div>
      <nav style="display:flex; gap:8px">
        <a href="#nosotros">Nosotros</a>
        <a href="#planes">Planes</a>
        <a href="#servicios">Otros Servicios</a>
        <a href="#capacitacion">Capacitación</a>
        <a href="#contacto">Contacto</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section id="inicio" class="container hero">
      <div class="reveal">
        <span class="badge">Consultoría • Operación • Capacitación</span>
        <h1>Centro de soluciones para tu negocio</h1>
        <p class="lead">Ordenamos, optimizamos y escalamos operaciones retail con estrategias prácticas y personalizadas.</p>
        <div class="cta">
          <a class="btn btn-primary" href="#" id="openModalBtn2">Pedir cotización</a>
          <a class="btn btn-ghost" href="#planes">Ver planes</a>
        </div>
      </div>
      <div class="card reveal">
        <img src="assets/Logo-sf-ss.png" alt="Mockup Retail Hub" onerror="this.replaceWith(document.getElementById('logoInline').content.cloneNode(true))"/>
      </div>
    </section>

    <!-- NOSOTROS -->
    <section id="nosotros" class="container">
      <div class="reveal">
        <h2>Nosotros</h2>
        <p>Sumamos más de 20 años de experiencia combinada en operación, capacitación, diseño y marketing retail. Hemos vivido los retos del piso de venta y la gestión de equipos, transformando la teoría en resultados reales. Nuestro compromiso es ayudarte a ordenar, optimizar y escalar tu negocio con estrategias prácticas y personalizadas.</p>
      </div>
    </section>

    <!-- PLANES -->
    <section id="planes" class="container">
      <div class="reveal"><h2>Planes</h2></div>
      <div class="grid3 pricing">
        <article id="planBasico" data-plan="Básico" class="card reveal glow" style="--accent: var(--brand-white); --accentA: rgba(255,255,255,.35); border:2px solid var(--accent)">
          <span class="pill">Básico</span>
          <h3>Organiza y estandariza</h3>
          <p class="price">Entra con orden</p>
          <p class="tag">Procesos esenciales y bases sólidas.</p>
          <ul class="list-simple">
            <li>Checklist de operación</li>
            <li>Estandarización de exhibiciones</li>
            <li>Controles básicos de inventario</li>
          </ul>
        </article>
        <article id="planPro" data-plan="Pro" class="card reveal glow" style="--accent: var(--brand-blue); --accentA: rgba(21,112,239,.35); border:2px solid var(--accent)">
          <span class="pill">Pro</span>
          <h3>Optimiza y reduce pérdidas</h3>
          <p class="price">Acompañamiento mensual</p>
          <p class="tag">Rotación, mermas y desempeño.</p>
          <ul class="list-simple">
            <li>Conteos cíclicos y rotación</li>
            <li>Indicadores operativos básicos</li>
            <li>Formación de líderes multifuncionales</li>
          </ul>
        </article>
        <article id="planMax" data-plan="Max" class="card reveal glow" style="--accent: var(--brand-green); --accentA: rgba(22,163,74,.35); border:2px solid var(--accent)">
          <span class="pill">Max</span>
          <h3>Escala con estrategia</h3>
          <p class="price">KPIs + capacitación continua</p>
          <p class="tag">Consultoría estratégica para crecer.</p>
          <ul class="list-simple">
            <li>KPIs y dashboard de gestión</li>
            <li>Liderazgo y manejo de equipos</li>
            <li>Programa de capacitación mensual</li>
          </ul>
        </article>
      </div>
    </section>

    <!-- SERVICIOS -->
    <section id="servicios" class="container">
      <div class="reveal"><h2>Otros Servicios</h2></div>
      <div class="grid3">
        <div class="card reveal">
          <h3>Soporte operativo</h3>
          <ul class="list-simple">
            <li>Gestión de inventarios</li>
            <li>Administración de tienda</li>
            <li>Mercadeo de productos</li>
            <li>Monitoreo de servicio al cliente</li>
          </ul>
        </div>
        <div class="card reveal">
          <h3>Consultorías</h3>
          <ul class="list-simple">
            <li>Análisis de Rentabilidad y ventas</li>
            <li>Estrategias de mejora para Experiencia del cliente</li>
            <li>Diseño de almacenes</li>
            <li>Ejecución de Inventarios generales</li>
          </ul>
        </div>
        <div class="card reveal">
          <h3>Soporte de ventas</h3>
          <ul class="list-simple">
            <li>Análisis de Ventas Cruzadas</li>
            <li>Evaluación de Productos Clave</li>
            <li>Planeación Estrátegica de Inventario</li>
            <li>Tácticas Comerciales Personalizadas</li>
            <li>Reportes Ejecutivos Simplificados</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- CAPACITACIÓN -->
    <section id="capacitacion" class="container">
      <div class="reveal"><h2>Capacitaciones</h2></div>
      <div class="grid3">
        <div class="card reveal">
          <h3>Operación</h3>
          <ul class="list-simple">
            <li>Lineamientos de marca y exhibiciones</li>
            <li>Diseño de controles básicos</li>
            <li>Manejo de indicadores operativos</li>
          </ul>
        </div>
        <div class="card reveal">
          <h3>Ventas</h3>
          <ul class="list-simple">
            <li>Atención a clientes</li>
            <li>Manejo de objeciones</li>
            <li>Escalamiento y venta cruzada</li>
          </ul>
        </div>
        <div class="card reveal">
          <h3>Liderazgo</h3>
          <ul class="list-simple">
            <li>Liderazgo estratégico</li>
            <li>Manejo de equipos</li>
            <li>Retroalimentación de equipos</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- CONTACTO -->
    <section id="contacto" class="container">
      <div class="reveal"><h2>Contacto</h2></div>
      <div class="card reveal">
        <p>Cuéntanos de tu tienda y te proponemos un plan claro.</p>
        <p>Correo: <a href="mailto:retailoc.soporte@gmail.com">retailoc.soporte@gmail.com</a></p>
        <p>Contacto: <a target="_blank" rel="noopener" href="https://wa.me/525553815006">+52 55 5381 5006 / +52 55 6529 8440</a></p>
      </div>
    </section>
  </main>

  <!-- ===== Modal de Cotización ===== -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <header style="display:flex; align-items:center; gap:10px;">
        <h3 id="modalTitle">Solicitar cotización</h3>
        <button type="button" class="close" id="closeModalBtn">Cerrar ✕</button>
      </header>

      <form id="form-asesoria" target="hidden_iframe" onsubmit="window.__formSubmitted=true" action="https://script.google.com/macros/s/AKfycbyGrrb7CDFavz_u-pX4y4ptRfcVP-yNt3Guibp4TLXslMmnDMF-itvWnxIEJ8c5_gJc/exec" method="POST">
        <div class="card" style="margin-bottom:12px">
          <h4>Datos de contacto</h4>
          <div class="row">
            <div>
              <label>Nombre de la persona de contacto</label>
              <input name="contacto_nombre" required />
            </div>
            <div>
              <label>Teléfono / WhatsApp</label>
              <input name="contacto_tel" required />
            </div>
            <div>
              <label>Correo</label>
              <input type="email" name="contacto_email" required />
            </div>
            <div>
              <label>Nombre del negocio</label>
              <input name="negocio_nombre" required />
            </div>
          </div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <h4>¿Qué necesitas?</h4>
          <div class="row">
            <div>
              <label>Rubro</label>
              <select id="rubro" name="rubro" required>
                <option value="">Selecciona…</option>
                <option value="Estrategias">Estrategias</option>
                <option value="Inventarios">Inventarios</option>
                <option value="Soporte Operativo">Soporte Operativo</option>
                <option value="Soporte Ventas">Soporte Ventas</option>
                <option value="Capacitación">Capacitación</option>
              </select>
            </div>
            <div>
              <label>Servicio</label>
              <select id="servicio" name="servicio" required disabled>
                <option value="">Selecciona un rubro…</option>
              </select>
            </div>
          </div>
        </div>

        <div id="preguntas" class="card" style="display:none; margin-bottom:12px">
          <h4>Cuéntanos un poco más</h4>
          <div id="contenedor-preguntas"></div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <h4>Mensaje adicional (opcional)</h4>
          <textarea name="mensaje" placeholder="Detalles, urgencia o fechas deseadas"></textarea>
        </div>

        <input type="hidden" name="_subject" value="Nueva solicitud de cotización — Retail Hub" />
        <button class="btn btn-submit" type="submit">Enviar solicitud</button>
        <p class="helper">Te contactaremos por correo lo antes posible.</p>
      </form>
    </div>
  </div>

  <!-- ===== Modal de Plan ===== -->
  <div class="modal-backdrop" id="planModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="planModalTitle">
      <header style="display:flex; align-items:center; gap:10px;">
        <h3 id="planModalTitle">Detalle del plan</h3>
        <button type="button" class="close" id="closePlanModalBtn">Cerrar ✕</button>
      </header>

      <div id="planContent" class="card" style="margin-bottom:12px"></div>
      <button class="btn btn-submit" id="planCtaBtn" type="button"></button>
      <p class="helper">Te contactaremos para coordinar la contratación.</p>
    </div>
  </div>

  <!-- ===== Modal de Agenda ===== -->
  <div class="modal-backdrop" id="agendaModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="agendaTitle">
      <header style="display:flex; align-items:center; gap:10px;">
        <h3 id="agendaTitle">Agendar cita</h3>
        <button type="button" class="close" id="closeAgendaBtn">Cerrar ✕</button>
      </header>

      <div class="card" style="margin-bottom:12px">
        <h4>Elige fecha y hora</h4>
        <div>
          <label class="sr-only">Fecha y hora</label>
          <div class="input-group" id="agendaDateTimeGroup">
            <input id="agendaDate" class="input-lite left" placeholder="dd/mm/aaaa" required readonly />
            <select id="agendaTime" class="select-lite right" required>
              <option value="">Hora…</option>
              <!-- se llena por JS -->
            </select>
          </div>
        </div>

        <h4 style="margin-top:14px">Tus datos</h4>
        <div class="row">
          <div>
            <label>Nombre</label>
            <input id="agendaNombre" placeholder="Nombre y apellidos" required />
          </div>
          <div>
            <label>Teléfono</label>
            <input id="agendaTel" placeholder="+52 ..." required />
          </div>
        </div>

        <h4 style="margin-top:14px">Dirección</h4>
        <div class="row">
          <div style="grid-column: 1 / -1">
            <label>Calle</label>
            <input id="addrCalle" placeholder="Calle" required />
          </div>
          <div>
            <label>Número exterior</label>
            <input id="addrNumExt" placeholder="Ej. 123" required />
          </div>
          <div>
            <label>Número interior (opcional)</label>
            <input id="addrNumInt" placeholder="Depto / Interior" />
          </div>
          <div>
            <label>Colonia</label>
            <input id="addrColonia" required />
          </div>
          <div>
            <label>Código postal</label>
            <input id="addrCP" required />
          </div>
          <div>
            <label>Estado</label>
            <input id="addrEstado" required />
          </div>
        </div>

        <p class="helper" id="agendaPlanHelper" style="margin-top:8px"></p>
      </div>

      <button class="btn btn-submit" id="agendaConfirmBtn" type="button">Confirmar cita</button>
      <p class="helper">Al confirmar, te contactaremos para coordinar.</p>
    </div>
  </div>

  <footer>
    <div class="container" style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap">
      <p>© <span id="year"></span> Retail Hub.</p>
      <p style="font-size:13px">Hecho con ❤️ y hospedado gratis en GitHub Pages.</p>
    </div>
  </footer>

<!-- === JS START: RetailHub === -->
<script>
const ENDPOINT = "https://script.google.com/macros/s/AKfycbyGrrb7CDFavz_u-pX4y4ptRfcVP-yNt3Guibp4TLXslMmnDMF-itvWnxIEJ8c5_gJc/exec";
let PLAN_CTA_TEXT = 'Agendar Cita';

// Año + reveals
document.getElementById('year').textContent = new Date().getFullYear();
const obs = new IntersectionObserver((entries)=>{
  entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('visible'); obs.unobserve(e.target) }})
},{threshold:.12});
document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));

// Helpers modal cotización
const modal = document.getElementById('modal');
const openModal = ()=> modal.classList.add('active');
const closeModal = ()=> modal.classList.remove('active');
const byId = (id)=> document.getElementById(id);
const safeOn = (id, ev, fn)=>{ const el = byId(id); if(el) el.addEventListener(ev, fn); };

safeOn('openModalBtn2','click', (e)=>{ e.preventDefault(); openModal(); });
safeOn('openModalBtn3','click', (e)=>{ e.preventDefault(); openModal(); });
safeOn('closeModalBtn','click', (e)=>{ e.preventDefault(); closeModal(); });
safeOn('brandHome', 'click', (e)=>{
  e.preventDefault();
  const home = document.getElementById('inicio');
  if (home) home.scrollIntoView({ behavior: 'smooth' });
  else window.scrollTo({ top: 0, behavior: 'smooth' });
});
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

// === SECTION: AGENDA (Fecha sola + Select de hora; L–V, mañana +15, slots 9–13) ===
const agendaModal   = document.getElementById('agendaModal');
const agendaConfirm = document.getElementById('agendaConfirmBtn');
const agendaHelper  = document.getElementById('agendaPlanHelper');

// Dirección detallada
const addrCalle   = document.getElementById('addrCalle');
const addrNumExt  = document.getElementById('addrNumExt');
const addrNumInt  = document.getElementById('addrNumInt');
const addrColonia = document.getElementById('addrColonia');
const addrCP      = document.getElementById('addrCP');
const addrEstado  = document.getElementById('addrEstado');

const openAgendaModal  = () => { initAgenda(); agendaModal.classList.add('active'); };
const closeAgendaModal = () => agendaModal.classList.remove('active');
document.getElementById('closeAgendaBtn')?.addEventListener('click', e=>{ e.preventDefault(); closeAgendaModal(); });
agendaModal?.addEventListener('click', e=>{ if(e.target===agendaModal) closeAgendaModal(); });

// Slots válidos 9–13
const AGENDA_SLOTS = [9,10,11,12,13];
let LAST_PLAN_PICKED = null;
['planBasico','planPro','planMax'].forEach(id=>{
  const el = document.getElementById(id);
  if (el) el.addEventListener('click', ()=>{ LAST_PLAN_PICKED = el.dataset.plan || null; });
});

// Utils fecha
function isWeekend(d){ const wd=d.getDay(); return (wd===0||wd===6); }
function nextWeekday(d){ const nd=new Date(d); while(isWeekend(nd)) nd.setDate(nd.getDate()+1); return nd; }
function startOfDay(d){ return new Date(d.getFullYear(),d.getMonth(),d.getDate()); }
function getMinDate(){ const t=new Date(); const s=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1); return nextWeekday(s); }
function addBusinessDays(start, days){
  const d = new Date(start);
  let added = 0;
  while(added < days){
    d.setDate(d.getDate()+1);
    const wd = d.getDay();
    if(wd!==0 && wd!==6) added++;
  }
  return d;
}
function getMaxDate(min){ return addBusinessDays(min, 10); }
function formatHour12(h24){ const ampm=(h24>=12)?'PM':'AM'; let h=h24%12; if(h===0)h=12; return `${String(h).padStart(2,'0')}:00 ${ampm}`; }

let fpDate; // flatpickr solo fecha

function initAgenda(){
  const dateInput = document.getElementById('agendaDate');
  const timeSel   = document.getElementById('agendaTime');
  if (!dateInput || !timeSel) return;

  // Flatpickr solo FECHA
  if (fpDate && typeof fpDate.destroy==='function') fpDate.destroy();
  const minDate = getMinDate();
  const maxDate = getMaxDate(minDate);
  const modalShell = agendaModal?.querySelector('.modal') || undefined;

  fpDate = flatpickr(dateInput, {
    allowInput:false, disableMobile:true,
    locale:(window.flatpickr?.l10ns?.es)||undefined,
    enableTime:false, dateFormat:"d/m/Y",
    minDate:startOfDay(minDate), maxDate:startOfDay(maxDate),
    static:true, appendTo:modalShell,
    disable:[(date)=>{ const d=date.getDay(); return (d===0||d===6); }],
    onReady(_s,_str,inst){
      const d=new Date(minDate.getFullYear(),minDate.getMonth(),minDate.getDate());
      inst.setDate(d,true); dateInput.value = inst.formatDate(d,"d/m/Y");
    }
  });

  // Llenar select de horas (9–13)
  timeSel.innerHTML = '<option value="">Hora…</option>';
  AGENDA_SLOTS.forEach(h=>{
    const opt=document.createElement('option');
    opt.value=String(h); opt.textContent=formatHour12(h);
    timeSel.appendChild(opt);
  });

  agendaHelper.textContent = LAST_PLAN_PICKED ? `Plan seleccionado: ${LAST_PLAN_PICKED}` : '';
}

// Confirmar cita
agendaConfirm?.addEventListener('click', async ()=>{
  const dateStr = (document.getElementById('agendaDate')?.value||'').trim(); // dd/mm/aaaa
  const hourStr = (document.getElementById('agendaTime')?.value||'').trim(); // 9..13
  if(!dateStr){ alert('Elige una fecha.'); return; }
  if(!hourStr){ alert('Elige una hora.'); return; }
  const h = Number(hourStr);
  if(!AGENDA_SLOTS.includes(h)){ alert('Elige un horario válido entre 09:00 y 01:00 PM.'); return; }

  const [dd,mm,yyyy] = dateStr.split('/');
  const fechaISO = `${yyyy}-${mm.padStart(2,'0')}-${dd.padStart(2,'0')}`;
  const probe = new Date(`${fechaISO}T00:00:00`);
  if (isNaN(probe.getTime()) || isWeekend(probe)){ alert('Solo atendemos de lunes a viernes.'); return; }

  const nombre = (document.getElementById('agendaNombre')?.value||'').trim();
  const tel    = (document.getElementById('agendaTel')?.value||'').trim();
  if(!nombre || !tel){ alert('Por favor llena Nombre y Teléfono.'); return; }

  if(!(addrCalle?.value && addrNumExt?.value && addrColonia?.value && addrCP?.value && addrEstado?.value)){
    alert('Completa los campos de dirección obligatorios.'); return;
  }
  const dir = [
    (addrCalle.value||'').trim(),
    'No. '+(addrNumExt.value||'').trim(),
    (addrNumInt?.value ? 'Int. '+addrNumInt.value.trim() : ''),
    (addrColonia.value||'').trim(),
    (addrCP.value||'').trim(),
    (addrEstado.value||'').trim()
  ].filter(Boolean).join(', ');

  const fechaNice = new Date(fechaISO+'T00:00:00').toLocaleDateString('es-MX',{weekday:'long', day:'2-digit', month:'long', year:'numeric'});
  const plan = (typeof LAST_PLAN_PICKED==='string' && LAST_PLAN_PICKED) ? LAST_PLAN_PICKED : 'Plan';
  const subject = `Cita — ${plan} — ${fechaNice} ${formatHour12(h)}`;
  const mensaje = [
    `Solicitud de cita para: ${plan}`,
    `Fecha: ${fechaNice}`,
    `Hora: ${formatHour12(h)} (CDMX)`,
    `Nombre: ${nombre}`,
    `Teléfono: ${tel}`,
    `Dirección: ${dir}`
  ].join('\n');

  const data = new URLSearchParams();
  data.set('_subject', subject);
  data.set('mensaje', mensaje);
  data.set('contacto_nombre', nombre);
  data.set('contacto_tel', tel);
  data.set('rubro', 'Planes');
  data.set('servicio', plan);

  const btn=agendaConfirm, prev=btn.textContent; btn.disabled=true; btn.textContent='Enviando...';
  try{
    const resp = await fetch(ENDPOINT,{ method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'}, body:data });
    if(resp.ok){ alert('¡Listo! Tu cita fue solicitada. Te contactaremos para confirmar.'); closeAgendaModal?.(); }
    else{ alert('No se pudo enviar la cita. '+await resp.text()); }
  }catch(err){ console.error(err); alert('Error de red al enviar la cita. Inténtalo de nuevo.'); }
  finally{ btn.disabled=false; btn.textContent=prev; }
});

/* ===== Modal de Plan ===== */
const planModal      = document.getElementById('planModal');
const planContent    = document.getElementById('planContent');
const planCtaBtn     = document.getElementById('planCtaBtn');
const planModalTitle = document.getElementById('planModalTitle');

const openPlanModal  = () => planModal.classList.add('active');
const closePlanModal = () => planModal.classList.remove('active');

document.getElementById('closePlanModalBtn')?.addEventListener('click', (e)=>{ e.preventDefault(); closePlanModal(); });
planModal && planModal.addEventListener('click', (e)=>{ if(e.target===planModal) closePlanModal(); });

const PLAN_DETAIL = {
  "Básico": `
    <div style="margin-bottom:10px">
      <div style="text-align:center; margin-bottom:10px">
        <div style="font-weight:800;font-size:28px; line-height:1.2">$12,000</div>
        <div class="helper" style="font-size:14px">(Pago por proyecto)</div>
      </div>
      <h4 style="margin:6px 0 10px">Organiza y estandariza</h4>
      <p class="helper" style="margin:0 0 10px">Ideal para negocios pequeños que quieren ordenarse.</p>
    </div>
    <h4 style="margin:10px 0 6px">Desglose de servicios</h4>
    <ul class="list-simple">
      <li>Visita o mystery shopper inicial → traslado + 1 jornada de trabajo.</li>
      <li>Diagnóstico y reporte escrito → análisis + documento con hallazgos y mejoras inmediatas.</li>
      <li>Capacitación básica (4 hrs) → sesión en piso de venta con el equipo.</li>
      <li>Checklist de estándares mínimos de exhibición.</li>
      <li>Revisión de controles básicos (entradas/salidas).</li>
    </ul>
  `,
  "Pro": `
    <div style="margin-bottom:10px">
      <div style="text-align:center; margin-bottom:10px">
        <div style="font-weight:800;font-size:28px; line-height:1.2">$20,000</div>
        <div class="helper" style="font-size:14px">(Mensuales)</div>
      </div>
      <h4 style="margin:6px 0 10px">Optimiza y reduce pérdidas</h4>
      <p class="helper" style="margin:0 0 10px">Para tiendas con flujo más grande que quieren optimizar pérdidas y rotación.</p>
    </div>
    <h4 style="margin:10px 0 6px">Desglose de servicios</h4>
    <ul class="list-simple">
      <li>Todo lo del Básico.</li>
      <li>2 visitas presenciales al mes → piso de venta + almacén.</li>
      <li>Manual de operación personalizado → documento base para la tienda.</li>
      <li>Capacitación a líderes y multifuncionales (1 sesión mensual).</li>
      <li>Plan de control de inventarios cíclicos → sistema de conteos periódicos.</li>
      <li>Reporte mensual con hallazgos + mejoras.</li>
    </ul>
  `,
  "Max": `
    <div style="margin-bottom:10px">
      <div style="text-align:center; margin-bottom:10px">
        <div style="font-weight:800;font-size:28px; line-height:1.2">$35,000</div>
        <div class="helper" style="font-size:14px">(Mensuales)</div>
      </div>
      <h4 style="margin:6px 0 10px">Escala con estrategia</h4>
      <p class="helper" style="margin:0 0 10px">Pensado para negocios que buscan escalar o franquiciar.</p>
    </div>
    <h4 style="margin:10px 0 6px">Desglose de servicios</h4>
    <ul class="list-simple">
      <li>Todo lo del Intermedio.</li>
      <li>Capacitación continua (programa anual) → calendario de entrenamientos.</li>
      <li>Diagnóstico semestral tipo mystery shopper (extra a las visitas).</li>
      <li>KPI’s personalizados y dashboard → cuadro de mando para dueños/gerentes.</li>
      <li>Soporte remoto ilimitado (WhatsApp, llamadas, Zoom).</li>
      <li>Reporte ejecutivo mensual con recomendaciones estratégicas.</li>
    </ul>
  `
};

['planBasico','planPro','planMax'].forEach(id => {
  const card = document.getElementById(id);
  if (!card) return;
  card.style.cursor = 'pointer';
  card.addEventListener('click', ()=>{
    const planName = card.dataset.plan || 'Plan';
    planModalTitle.textContent = `Detalle del plan — ${planName}`;
    planContent.innerHTML = PLAN_DETAIL[planName] || '<p>Plan no disponible.</p>';
    planCtaBtn.textContent = PLAN_CTA_TEXT;

    const planKey = planName.normalize('NFD').replace(/[\u0300-\u036f]/g,''); // 'Básico' -> 'Basico'
    planModal.classList.remove('plan--Basico','plan--Pro','plan--Max');
    planModal.classList.add(`plan--${planKey}`);

    openPlanModal();
  });
});

planCtaBtn && planCtaBtn.addEventListener('click', ()=>{
  closePlanModal();
  openAgendaModal();
});

/* ===== Cotización (Apps Script) ===== */

/* ===== Cotización (Apps Script) ===== */
// Mapeo de Rubro -> Servicios -> Preguntas
const CONFIG = {
  "Estrategias": {
    "Análisis de rentabilidad": [
      "¿Conoce su utilidad neta actual? (sí/no)",
      "¿Cuál considera que es su mayor gasto operativo?",
      "Objetivo del análisis (reducir gastos, mejorar márgenes, planificar crecimiento)"
    ],
    "Análisis de ventas": [
      "¿Registra ventas diario/semanal? (sí/no)",
      "¿Qué tan estables son sus ventas mensuales? (muy variables / estables)",
      "¿Qué desea mejorar? (ticket promedio, número de clientes, frecuencia)"
    ],
    "Nivel de experiencia del cliente": [
      "¿Mide la satisfacción del cliente? (sí/no)",
      "¿Cómo obtiene retroalimentación? (comentarios, encuestas, ninguno)",
      "¿Qué desea mejorar? (tiempo de atención, calidad, fidelidad)"
    ]
  },
  "Inventarios": {
    "Diseño de almacenes": [
      "¿Cuenta con un espacio definido de almacén? (sí/no)",
      "Principal problema (falta de espacio, desorden, pérdidas)",
      "Metros cuadrados aproximados del área"
    ],
    "Creación de base de datos": [
      "¿Tiene sistema digital de inventarios? (Excel, POS, ninguno)",
      "Número aproximado de productos/SKUs",
      "¿Requiere importación de datos actuales? (sí/no)"
    ],
    "Inventarios generales": [
      "¿Cada cuánto realiza conteos generales?",
      "Mayor problema (faltantes, mermas, exceso de stock)",
      "¿Cuenta con personal para los conteos? (sí/no)"
    ]
  },
  "Soporte Operativo": {
    "Mercadeo de productos": [
      "Métodos actuales de exhibición/promoción",
      "Objetivo principal (rotación, destacar nuevas líneas, incrementar ventas)",
      "¿Cuenta con calendario/promociones vigentes? (sí/no)"
    ],
    "Servicio al cliente": [
      "¿Personal capacitado en servicio? (sí/no)",
      "Aspecto por mejorar (tiempo de atención, resolución, trato)",
      "¿Cuenta con protocolos escritos? (sí/no)"
    ],
    "Administración de tienda": [
      "¿Lleva controles diarios de caja, ventas y gastos? (sí/no)",
      "Reto principal (organización, personal, control de gastos)",
      "Sistema que usa hoy (manual, Excel, POS)"
    ]
  },
  "Soporte Ventas": {
    "Mystery Shoper": [
      "¿Ha usado mystery shopper antes? (sí/no)",
      "¿Qué desea evaluar? (atención, rapidez, conocimiento)",
      "Número de sucursales a evaluar"
    ],
    "Reporte Basket Market": [
      "¿Analiza productos que se venden juntos? (sí/no)",
      "Objetivo (combos, promociones, layout)",
      "¿Cuenta con histórico de tickets? (sí/no)"
    ],
    "Reporte Pareto": [
      "¿Conoce su top 20% de productos? (sí/no)",
      "Objetivo (enfocar compras, reducir inventario lento, margen)",
      "Período a analizar (mes actual, 3 meses, 12 meses)"
    ],
    "Planeación de la demanda": [
      "¿Cuenta con histórico de ventas? (sí/no)",
      "Objetivo (abastecimiento, reducir faltantes, flujo de caja)",
      "Horizonte de planeación deseado (semanal, mensual, trimestral)"
    ],
    "Estrategias de venta": [
      "¿Principal reto actual? (atraer, cerrar, fidelizar)",
      "Canal principal (tienda física, online, ambos)",
      "Objetivo de la estrategia (más clientes, mayor ticket, recurrencia)"
    ]
  },
  "Capacitación": {
    "Atención a clientes": [
      "¿Cuántas personas requieren capacitación?",
      "Modalidad preferida (presencial, en línea, mixta)",
      "Objetivo (satisfacción, fidelización, reducir quejas)"
    ],
    "Manejo de objeciones": [
      "¿El equipo enfrenta objeciones frecuentes? (sí/no)",
      "Objetivo (cerrar más ventas, confianza del equipo)",
      "Experiencia del equipo (baja, media, alta)"
    ],
    "Estandarización de exhibiciones": [
      "¿Cuentan con lineamientos de exhibición? (sí/no)",
      "Reto principal (orden, limpieza, reposición, señalización)",
      "Frecuencia de cambios de exhibición"
    ],
    "Diseño de controles básicos": [
      "¿Qué controles necesita? (entradas/salidas, caja, mermas)",
      "Herramienta actual (manual, Excel, sistema)",
      "Objetivo (menos errores, visibilidad, auditoría)"
    ],
    "Liderez y multifuncionales": [
      "Número de líderes/encargados",
      "Competencias a desarrollar (delegación, supervisión, rotación)",
      "Formato deseado (taller, coaching, programa)"
    ],
    "Manejo de indicadores operativos": [
      "¿Indicadores que ya usan? (ventas, rotación, mermas)",
      "Nivel requerido (básico, intermedio, avanzado)",
      "Objetivo (toma de decisiones, seguimiento, reportes)"
    ],
    "Liderazgo estratégico": [
      "Etapa del negocio (arranque, crecimiento, madurez)",
      "Reto principal (motivación, decisiones, expansión)",
      "Formato (curso, workshop, programa mensual)"
    ],
    "Manejo de equipos": [
      "Tamaño del equipo",
      "Reto (disciplina, coordinación, productividad)",
      "Objetivo (clima laboral, eficiencia, cumplimiento)"
    ],
    "Lineamientos de marca": [
      "¿Existen estándares de marca? (sí/no)",
      "Áreas a cubrir (uniforme, atención, exhibición, comunicación)",
      "Objetivo (uniformidad, identidad, presentación)"
    ]
  }
};

// Lógica Rubro -> Servicio
const rubroSel = document.getElementById('rubro');
const servicioSel = document.getElementById('servicio');
const preguntasCard = document.getElementById('preguntas');
const contPreg = document.getElementById('contenedor-preguntas');

rubroSel?.addEventListener('change', () => {
  servicioSel.innerHTML = '<option value="">Selecciona…</option>';
  servicioSel.disabled = true;
  contPreg.innerHTML = '';
  preguntasCard.style.display = 'none';
  const rubro = rubroSel.value;
  if(!rubro || !CONFIG[rubro]) return;
  Object.keys(CONFIG[rubro]).forEach(s => {
    const opt = document.createElement('option'); opt.value = s; opt.textContent = s;
    servicioSel.appendChild(opt);
  });
  servicioSel.disabled = false;
});

servicioSel?.addEventListener('change', () => {
  contPreg.innerHTML = '';
  const rubro = rubroSel.value, serv = servicioSel.value;
  if(!rubro || !serv) { preguntasCard.style.display='none'; return; }
  const preguntas = CONFIG[rubro][serv] || [];

  preguntas.forEach((q, i) => {
    const wrap = document.createElement('div'); wrap.style.marginBottom='10px';
    const lab = document.createElement('label'); lab.textContent = q;
    const inp = document.createElement('input'); inp.name = `q_${i+1}_value`; inp.required = true;
    const hidden = document.createElement('input'); hidden.type = 'hidden'; hidden.name = `q_${i+1}_label`; hidden.value = q;
    wrap.appendChild(lab); wrap.appendChild(inp); wrap.appendChild(hidden);
    contPreg.appendChild(wrap);
  });
  const count = document.createElement('input'); count.type = 'hidden'; count.name = 'q_count'; count.value = preguntas.length;
  contPreg.appendChild(count);
  preguntasCard.style.display = 'block';
});

</script>
<!-- === JS END: RetailHub === -->

<iframe name="hidden_iframe" id="hidden_iframe" style="display:none"></iframe>
<script>
  // Mensaje de éxito cuando GAS responde (no leemos el contenido; sólo detectamos el retorno al iframe)
  const _iframe = document.getElementById('hidden_iframe');
  _iframe.addEventListener('load', () => {
    if (window.__formSubmitted) {
      window.__formSubmitted = false;
      // feedback al usuario sin abandonar la página
      alert('¡Solicitud enviada! Te contactaremos por correo pronto.');
      try{
        document.getElementById('form-asesoria').reset();
        const cont = document.getElementById('contenedor-preguntas');
        if(cont) cont.innerHTML = '';
        const card = document.getElementById('preguntas');
        if(card) card.style.display='none';
        const close = document.getElementById('closeModalBtn');
        if(close) close.click();
      }catch(_){}
    }
  });
</script>

<template id="logoInline">
  <svg viewBox="0 0 320 72" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Retail Hub">
    <rect x="0" y="0" width="320" height="72" rx="12" fill="#0F1626" stroke="#3b82f6" />
    <text x="20" y="46" font-family="Inter, Arial" font-weight="800" font-size="34" fill="#34d399">HUB</text>
    <text x="20" y="30" font-family="Inter, Arial" font-weight="800" font-size="22" fill="#93c5fd">RETAIL</text>
  </svg>
</template>

</body>
</html>
